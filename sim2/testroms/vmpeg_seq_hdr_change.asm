	section .text

    org $400000

vector:
	dc.l $1234
	dc.l main

main:
	move.w #$0000,$303FFE ; Data buffer

	move.w #$2000,$E040C0 ; FMV SYSCMD - Decoder off
	nop
	move.w #$0100,$E040C0 ; FMV SYSCMD - Clear FIFO
	nop
	move.w #$1000,$E040C0 ; FMV SYSCMD - Decoder on

	move.w #$02D4,$E040DC ; FMV IVEC
	move.w #$F7CF,$E04060 ; FMV IER
	move.l #fmvirq,$168

	move.w #$807B,$E0300C ; FMA IVEC
	move.w #$013C,$E0301C ; FMA IER
	move.l #fmairq,$1EC

	move #$2000,SR

	move.b d0,$80004040 ; reset status
	move.l #mpeg_bin,$8000400c ; Memory Address Counter
	move.w #2324/2,$8000404a  ; Memory Transfer Counter
	move.b #$04,$80004046 ; SCR, MAC Count Up, DAC No Change (like the CDIC on CH1)
	move.b #$12,$80004045 ; Dev. to Mem., 16 Bit Words,
	move.b #$30,$80004044 ; ACK/RDY device (like the CDIC on CH1)
	move.b #$80,$80004047 ; start DMA

	move.l #0,$0E0407C ;FMV_DECOFF
	move.l #$01180180,$0E04078 ;FMV_DECWIN 384 x 280
	move.l #0,$0E04074 ;FMV_DECOFF
	move.w #$8,$0E040C2; Request Update

	move.w #$8000,$00E040C0 ; Syscmd = Start DMA

	; Usually one would use the DTS and SCR to start playback
	; But I feel lazy and use the number of pics instead
waitforpics:
	cmp.w #2,$00E040A4 ; Compare 1 against pictures in FIFO
	bmi waitforpics

	move.b #'B',$80002019

	move.w #$0008,$E040C0 ; FMV SYSCMD - Play
	move.w #$0420,$E040C2 ; FMV VIDCMD - Show on next frame

endless:
	bra endless


fmvirq:
	move.b #'V',$80002019
	move $00E04062,d7
	rte

fmairq:
	move.b #'A',$80002019
	move $00E0301A,d7
	rte

mpeg_bin:
    dc.b $00, $00, $01, $ba, $21, $00, $01, $00, $01, $c3, $33, $67
    dc.b $00, $00, $01, $bb, $00, $09, $c3, $33, $67, $00, $21, $ff
    dc.b $e0, $e0, $2e, $00, $00, $01, $e0, $07, $4a, $21, $00, $03
    dc.b $35, $61, $00, $00, $01, $b3, $01, $00, $80, $13, $02, $ce
    dc.b $e0, $a0, $00, $00, $01, $b8, $00, $08, $00, $40, $00, $00
    dc.b $01, $00, $00, $0f, $ff, $f8, $00, $00, $01, $01, $13, $fb
    dc.b $5d, $29, $48, $88, $00, $00, $01, $02, $13, $f8, $7d, $29
    dc.b $48, $88, $00, $00, $01, $03, $13, $f8, $7d, $29, $48, $88
    dc.b $00, $00, $01, $04, $13, $f8, $7d, $29, $48, $88, $00, $00
    dc.b $01, $05, $13, $f8, $7d, $29, $48, $88, $00, $00, $01, $06
    dc.b $13, $f8, $7d, $29, $48, $88, $00, $00, $01, $07, $13, $f8
    dc.b $7d, $29, $48, $88, $00, $00, $01, $08, $13, $f8, $7d, $29
    dc.b $48, $88, $00, $00, $01, $00, $00, $57, $ff, $f9, $80, $00
    dc.b $00, $01, $01, $12, $60, $b6, $00, $00, $01, $02, $12, $3e
    dc.b $08, $20, $c0, $24, $82, $01, $e0, $22, $89, $80, $10, $82
    dc.b $48, $58, $03, $a0, $4d, $eb, $a0, $20, $c0, $24, $82, $01
    dc.b $e0, $22, $89, $80, $10, $82, $48, $58, $03, $a0, $4d, $eb
    dc.b $bf, $44, $d2, $22, $00, $00, $01, $03, $12, $c8, $10, $00
    dc.b $3f, $c1, $04, $02, $b4, $10, $2f, $c1, $17, $a0, $10, $0c
    dc.b $c1, $27, $c0, $01, $48, $26, $90, $c0, $80, $01, $fe, $08
    dc.b $20, $15, $a0, $81, $7e, $08, $bd, $00, $80, $66, $09, $3e
    dc.b $00, $0a, $41, $34, $86, $00, $00, $01, $04, $12, $70, $00
    dc.b $00, $01, $05, $12, $70, $00, $00, $01, $06, $12, $70, $00
    dc.b $00, $01, $07, $12, $70, $00, $00, $01, $08, $12, $70, $00
    dc.b $00, $01, $00, $00, $97, $ff, $f8, $80, $00, $00, $01, $01
    dc.b $12, $70, $00, $00, $01, $02, $12, $3f, $87, $d2, $94, $88
    dc.b $80, $00, $00, $01, $03, $12, $3f, $87, $d2, $94, $88, $80
    dc.b $00, $00, $01, $04, $12, $3f, $68, $08, $30, $0e, $80, $81
    dc.b $56, $08, $bb, $80, $94, $28, $00, $a8, $13, $44, $28, $08
    dc.b $30, $0e, $80, $81, $56, $08, $bb, $80, $94, $28, $00, $a8
    dc.b $13, $44, $2f, $6f, $48, $88, $00, $00, $01, $05, $12, $c8
    dc.b $10, $1b, $41, $04, $02, $30, $10, $19, $41, $14, $c4, $12
    dc.b $b8, $01, $03, $5c, $13, $79, $60, $40, $6d, $04, $10, $08
    dc.b $c0, $40, $65, $04, $53, $10, $4a, $e0, $04, $0d, $70, $4d
    dc.b $e5, $80, $00, $00, $01, $06, $12, $70, $00, $00, $01, $07
    dc.b $12, $70, $00, $00, $01, $08, $12, $70, $00, $00, $01, $00
    dc.b $00, $d7, $ff, $f9, $00, $00, $00, $01, $01, $12, $70, $00
    dc.b $00, $01, $02, $12, $70, $00, $00, $01, $03, $12, $70, $00
    dc.b $00, $01, $04, $12, $60, $6e, $00, $00, $01, $05, $12, $62
    dc.b $80, $00, $00, $01, $06, $12, $3f, $68, $08, $30, $0e, $80
    dc.b $81, $56, $08, $bb, $80, $94, $28, $00, $a8, $13, $44, $28
    dc.b $08, $30, $0e, $80, $81, $56, $08, $bb, $80, $94, $28, $00
    dc.b $a8, $13, $44, $2f, $6f, $48, $88, $00, $00, $01, $07, $12
    dc.b $c8, $10, $1b, $41, $04, $02, $30, $10, $19, $41, $14, $c4
    dc.b $12, $b8, $01, $03, $5c, $13, $79, $60, $40, $6d, $04, $10
    dc.b $08, $c0, $40, $65, $04, $53, $10, $4a, $e0, $04, $0d, $70
    dc.b $4d, $e5, $80, $00, $00, $01, $08, $12, $70, $00, $00, $01
    dc.b $00, $01, $17, $ff, $f9, $00, $00, $00, $01, $01, $12, $70
    dc.b $00, $00, $01, $02, $12, $70, $00, $00, $01, $03, $12, $70
    dc.b $00, $00, $01, $04, $12, $70, $00, $00, $01, $05, $12, $70
    dc.b $00, $00, $01, $06, $12, $60, $6e, $00, $00, $01, $07, $12
    dc.b $62, $80, $00, $00, $01, $08, $12, $3f, $b5, $d2, $94, $88
    dc.b $80, $00, $00, $01, $00, $01, $57, $ff, $f9, $00, $00, $00
    dc.b $01, $01, $12, $3f, $b5, $d2, $94, $88, $80, $00, $00, $01
    dc.b $02, $12, $70, $00, $00, $01, $03, $12, $70, $00, $00, $01
    dc.b $04, $12, $70, $00, $00, $01, $05, $12, $70, $00, $00, $01
    dc.b $06, $12, $70, $00, $00, $01, $07, $12, $70, $00, $00, $01
    dc.b $08, $12, $60, $66, $00, $00, $01, $00, $01, $97, $ff, $f9
    dc.b $80, $00, $00, $01, $01, $12, $60, $b6, $00, $00, $01, $02
    dc.b $12, $3e, $08, $20, $c0, $24, $82, $01, $e0, $22, $89, $80
    dc.b $10, $82, $48, $58, $03, $a0, $4d, $eb, $a0, $20, $c0, $24
    dc.b $82, $01, $e0, $22, $89, $80, $10, $82, $48, $58, $03, $a0
    dc.b $4d, $eb, $bf, $44, $d2, $22, $00, $00, $01, $03, $12, $c8
    dc.b $10, $00, $3f, $c1, $04, $02, $b4, $10, $2f, $c1, $17, $a0
    dc.b $10, $0c, $c1, $27, $c0, $01, $48, $26, $90, $c0, $80, $01
    dc.b $fe, $08, $20, $15, $a0, $81, $7e, $08, $bd, $00, $80, $66
    dc.b $09, $3e, $00, $0a, $41, $34, $86, $00, $00, $01, $04, $12
    dc.b $70, $00, $00, $01, $05, $12, $70, $00, $00, $01, $06, $12
    dc.b $70, $00, $00, $01, $07, $12, $70, $00, $00, $01, $08, $12
    dc.b $70, $00, $00, $01, $00, $01, $d7, $ff, $f8, $80, $00, $00
    dc.b $01, $01, $12, $70, $00, $00, $01, $02, $12, $3f, $87, $d2
    dc.b $94, $88, $80, $00, $00, $01, $03, $12, $3f, $87, $d2, $94
    dc.b $88, $80, $00, $00, $01, $04, $12, $3f, $68, $08, $30, $0e
    dc.b $80, $81, $56, $08, $bb, $80, $94, $28, $00, $a8, $13, $44
    dc.b $28, $08, $30, $0e, $80, $81, $56, $08, $bb, $80, $94, $28
    dc.b $00, $a8, $13, $44, $2f, $6f, $48, $88, $00, $00, $01, $05
    dc.b $12, $c8, $10, $1b, $41, $04, $02, $30, $10, $19, $41, $14
    dc.b $c4, $12, $b8, $01, $03, $5c, $13, $79, $60, $40, $6d, $04
    dc.b $10, $08, $c0, $40, $65, $04, $53, $10, $4a, $e0, $04, $0d
    dc.b $70, $4d, $e5, $80, $00, $00, $01, $06, $12, $70, $00, $00
    dc.b $01, $07, $12, $70, $00, $00, $01, $08, $12, $70, $00, $00
    dc.b $01, $00, $02, $17, $ff, $f9, $00, $00, $00, $01, $01, $12
    dc.b $70, $00, $00, $01, $02, $12, $70, $00, $00, $01, $03, $12
    dc.b $70, $00, $00, $01, $04, $12, $60, $6e, $00, $00, $01, $05
    dc.b $12, $62, $80, $00, $00, $01, $06, $12, $3f, $68, $08, $30
    dc.b $0e, $80, $81, $56, $08, $bb, $80, $94, $28, $00, $a8, $13
    dc.b $44, $28, $08, $30, $0e, $80, $81, $56, $08, $bb, $80, $94
    dc.b $28, $00, $a8, $13, $44, $2f, $6f, $48, $88, $00, $00, $01
    dc.b $07, $12, $c8, $10, $1b, $41, $04, $02, $30, $10, $19, $41
    dc.b $14, $c4, $12, $b8, $01, $03, $5c, $13, $79, $60, $40, $6d
    dc.b $04, $10, $08, $c0, $40, $65, $04, $53, $10, $4a, $e0, $04
    dc.b $0d, $70, $4d, $e5, $80, $00, $00, $01, $08, $12, $70, $00
    dc.b $00, $01, $00, $02, $57, $ff, $f9, $00, $00, $00, $01, $01
    dc.b $12, $70, $00, $00, $01, $02, $12, $70, $00, $00, $01, $03
    dc.b $12, $70, $00, $00, $01, $04, $12, $70, $00, $00, $01, $05
    dc.b $12, $70, $00, $00, $01, $06, $12, $60, $6e, $00, $00, $01
    dc.b $07, $12, $62, $80, $00, $00, $01, $08, $12, $3f, $b5, $d2
    dc.b $94, $88, $80, $00, $00, $01, $b3, $08, $00, $10, $13, $02
    dc.b $ce, $e0, $a0, $00, $00, $01, $b8, $00, $08, $00, $40, $00
    dc.b $00, $01, $00, $00, $0f, $ff, $f8, $00, $00, $01, $01, $13
    dc.b $f8, $7d, $29, $48, $8b, $94, $a5, $22, $2e, $52, $94, $88
    dc.b $b9, $4a, $52, $22, $e5, $29, $48, $8b, $94, $a5, $22, $2e
    dc.b $52, $94, $88, $bf, $db, $74, $a5, $22, $20, $00, $00, $01
    dc.b $00, $00, $57, $ff, $f9, $00, $00, $00, $01, $01, $12, $72
    dc.b $62, $08, $00, $1f, $e0, $81, $00, $a6, $08, $77, $e0, $0b
    dc.b $81, $1c, $cc, $01, $f0, $25, $f2, $80, $17, $c0, $80, $01
    dc.b $fe, $08, $10, $0a, $60, $87, $7e, $00, $b8, $11, $cc, $c0
    dc.b $1f, $02, $5f, $28, $01, $7d, $1f, $da, $ef, $ce, $c0, $80
    dc.b $01, $6e, $08, $67, $80, $0e, $41, $1f, $78, $04, $e0, $96
    dc.b $20, $00, $f2, $fd, $13, $7e, $76, $04, $00, $0b, $70, $43
    dc.b $3c, $00, $72, $08, $fb, $c0, $27, $04, $b1, $00, $07, $91
    dc.b $14, $81, $9c, $00, $00, $01, $00, $00, $97, $ff, $f8, $80
    dc.b $00, $00, $01, $01, $12, $74, $c4, $10, $1b, $41, $02, $01
    dc.b $d0, $10, $d9, $41, $03, $3c, $12, $08, $01, $2f, $5c, $01
    dc.b $44, $08, $0d, $a0, $81, $00, $e8, $08, $6c, $a0, $81, $9e
    dc.b $09, $04, $00, $97, $ae, $00, $a2, $8f, $ed, $77, $88, $04
    dc.b $00, $08, $c0, $43, $ab, $00, $28, $04, $8e, $d0, $4b, $17
    dc.b $00, $ce, $f6, $f7, $88, $04, $00, $08, $c0, $43, $ab, $00
    dc.b $28, $04, $8e, $d0, $4b, $17, $00, $ce, $22, $8f, $f2, $dd
    dc.b $29, $48, $8a, $39, $4a, $52, $22, $9c, $00, $00, $01, $00
    dc.b $00, $d7, $ff, $f9, $00, $00, $00, $01, $01, $12, $7b, $10
    dc.b $40, $6d, $04, $08, $07, $40, $43, $65, $04, $0c, $f0, $48
    dc.b $20, $04, $bd, $70, $05, $10, $20, $36, $82, $04, $03, $a0
    dc.b $21, $b2, $82, $06, $78, $24, $10, $02, $5e, $b8, $02, $8a
    dc.b $3f, $b5, $de, $20, $10, $00, $23, $01, $0e, $ac, $00, $a0
    dc.b $12, $3b, $41, $2c, $5c, $03, $3b, $db, $de, $20, $10, $00
    dc.b $23, $01, $0e, $ac, $00, $a0, $12, $3b, $41, $2c, $5c, $03
    dc.b $38, $8a, $47, $c8, $1d, $d1, $c0, $00, $00, $01, $00, $01
    dc.b $17, $ff, $f9, $00, $00, $00, $01, $01, $12, $3f, $b5, $d2
    dc.b $94, $88, $a4, $7c, $81, $dc, $8e, $00, $00, $01, $00, $01
    dc.b $57, $ff, $f9, $80, $00, $00, $01, $01, $12, $41, $6e, $21
    dc.b $fd, $ae, $94, $a4, $44, $00, $00, $01, $00, $01, $97, $ff
    dc.b $f9, $00, $00, $00, $01, $01, $12, $72, $62, $08, $00, $1f
    dc.b $e0, $81, $00, $a6, $08, $77, $e0, $0b, $81, $1c, $cc, $01
    dc.b $f0, $25, $f2, $80, $17, $c0, $80, $01, $fe, $08, $10, $0a
    dc.b $60, $87, $7e, $00, $b8, $11, $cc, $c0, $1f, $02, $5f, $28
    dc.b $01, $7d, $1f, $da, $ef, $ce, $c0, $80, $01, $6e, $08, $67
    dc.b $80, $0e, $41, $1f, $78, $04, $e0, $96, $20, $00, $f2, $fd
    dc.b $13, $7e, $76, $04, $00, $0b, $70, $43, $3c, $00, $72, $08
    dc.b $fb, $c0, $27, $04, $b1, $00, $07, $91, $14, $81, $9c, $00
    dc.b $00, $01, $00, $01, $d7, $ff, $f8, $80, $00, $00, $01, $01
    dc.b $12, $74, $c4, $10, $1b, $41, $02, $01, $d0, $10, $d9, $41
    dc.b $03, $3c, $12, $08, $01, $2f, $5c, $01, $44, $08, $0d, $a0
    dc.b $81, $00, $e8, $08, $6c, $a0, $81, $9e, $09, $04, $00, $97
    dc.b $ae, $00, $a2, $8f, $ed, $77, $88, $04, $00, $08, $c0, $43
    dc.b $ab, $00, $28, $04, $8e, $d0, $4b, $17, $00, $ce, $f6, $f7
    dc.b $88, $04, $00, $08, $c0, $43, $ab, $00, $28, $04, $8e, $d0
    dc.b $4b, $17, $00, $ce, $22, $8f, $f2, $dd, $29, $48, $8a, $39
    dc.b $4a, $52, $22, $9c, $00, $00, $01, $00, $02, $17, $ff, $f9
    dc.b $00, $00, $00, $01, $01, $12, $7b, $10, $40, $6d, $04, $08
    dc.b $07, $40, $43, $65, $04, $0c, $f0, $48, $20, $04, $bd, $70
    dc.b $05, $10, $20, $36, $82, $04, $03, $a0, $21, $b2, $82, $06
    dc.b $78, $24, $10, $02, $5e, $b8, $02, $8a, $3f, $b5, $de, $20
    dc.b $10, $00, $23, $01, $0e, $ac, $00, $a0, $12, $3b, $41, $2c
    dc.b $5c, $03, $3b, $db, $de, $20, $10, $00, $23, $01, $0e, $ac
    dc.b $00, $a0, $12, $3b, $41, $2c, $5c, $03, $38, $8a, $47, $c8
    dc.b $1d, $d1, $c0, $00, $00, $01, $00, $02, $57, $ff, $f9, $00
    dc.b $00, $00, $01, $01, $12, $3f, $b5, $d2, $94, $88, $a4, $7c
    dc.b $81, $dc, $8e, $00, $00, $01, $be, $01, $a3, $0f, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff
    dc.b $ff, $ff, $ff, $ff, $ff, $ff, $ff, $ff